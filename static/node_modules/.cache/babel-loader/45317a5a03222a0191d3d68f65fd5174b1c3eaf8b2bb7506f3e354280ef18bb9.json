{"ast":null,"code":"/**\r\n * Column series module.\r\n */\nimport { __extends } from \"tslib\";\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\nimport { XYSeries, XYSeriesDataItem } from \"./XYSeries\";\nimport { visualProperties } from \"../../core/Sprite\";\nimport { Container } from \"../../core/Container\";\nimport { ListTemplate, ListDisposer } from \"../../core/utils/List\";\nimport { Dictionary } from \"../../core/utils/Dictionary\";\nimport { ValueAxis } from \"../axes/ValueAxis\";\nimport { CategoryAxis } from \"../axes/CategoryAxis\";\nimport { registry } from \"../../core/Registry\";\nimport { Column } from \"../elements/Column\";\nimport { RoundedRectangle } from \"../../core/elements/RoundedRectangle\";\nimport { percent, Percent } from \"../../core/utils/Percent\";\nimport * as $math from \"../../core/utils/Math\";\nimport * as $object from \"../../core/utils/Object\";\nimport * as $iter from \"../../core/utils/Iterator\";\nimport * as $array from \"../../core/utils/Array\";\nimport * as $type from \"../../core/utils/Type\";\nimport { Disposer } from \"../../core/utils/Disposer\";\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\n/**\r\n * Defines a [[DataItem]] for [[ColumnSeries]].\r\n *\r\n * @see {@link DataItem}\r\n */\nvar ColumnSeriesDataItem = /** @class */function (_super) {\n  __extends(ColumnSeriesDataItem, _super);\n  /**\r\n   * Constructor\r\n   */\n  function ColumnSeriesDataItem() {\n    var _this = _super.call(this) || this;\n    _this.className = \"ColumnSeriesDataItem\";\n    _this.locations[\"dateX\"] = 0.5;\n    _this.locations[\"dateY\"] = 0.5;\n    _this.locations[\"categoryX\"] = 0.5;\n    _this.locations[\"categoryY\"] = 0.5;\n    _this.applyTheme();\n    return _this;\n  }\n  Object.defineProperty(ColumnSeriesDataItem.prototype, \"column\", {\n    /**\r\n     * @return Column\r\n     */\n    get: function () {\n      return this._column;\n    },\n    /**\r\n     * A column used to draw a column for this data item.\r\n     *\r\n     * @param column\r\n     */\n    set: function (column) {\n      this.setColumn(column);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  ColumnSeriesDataItem.prototype.setColumn = function (column) {\n    var _this = this;\n    if (this._column && column != this._column) {\n      $array.remove(this.sprites, this._column);\n    }\n    this._column = column;\n    if (column) {\n      var prevDataItem = column.dataItem;\n      if (prevDataItem && prevDataItem != this) {\n        prevDataItem.column = undefined;\n      }\n      this.addSprite(column);\n      this._disposers.push(new Disposer(function () {\n        // TODO investigate why component is undefined\n        // https://codepen.io/team/amcharts/pen/dac4be245d658233a6d7e5597df2208b?editors=0010\n        if (_this.component) {\n          _this.component.columns.removeValue(column);\n        }\n      }));\n    }\n  };\n  Object.defineProperty(ColumnSeriesDataItem.prototype, \"width\", {\n    get: function () {\n      var width = this.properties.width;\n      if (this._adapterO) {\n        width = this._adapterO.apply(\"width\", width);\n      }\n      return width;\n    },\n    set: function (value) {\n      if (this.properties.width != value) {\n        this.properties.width = value;\n        if (this.component) {\n          this.component.validateDataElement(this);\n        }\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ColumnSeriesDataItem.prototype, \"height\", {\n    get: function () {\n      var height = this.properties.height;\n      if (this._adapterO) {\n        height = this._adapterO.apply(\"height\", height);\n      }\n      return height;\n    },\n    set: function (value) {\n      if (this.properties.height != value) {\n        this.properties.height = value;\n        if (this.component) {\n          this.component.validateDataElement(this);\n        }\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ColumnSeriesDataItem.prototype, \"rangesColumns\", {\n    /**\r\n     * A dictionary storing axes ranges columns by axis uid\r\n     */\n    get: function () {\n      if (!this._rangesColumns) {\n        this._rangesColumns = new Dictionary();\n      }\n      return this._rangesColumns;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return ColumnSeriesDataItem;\n}(XYSeriesDataItem);\nexport { ColumnSeriesDataItem };\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n/**\r\n * Defines [[Series]] for a column graph.\r\n *\r\n * @see {@link IColumnSeriesEvents} for a list of available Events\r\n * @see {@link IColumnSeriesAdapters} for a list of available Adapters\r\n * @todo Example\r\n * @important\r\n */\nvar ColumnSeries = /** @class */function (_super) {\n  __extends(ColumnSeries, _super);\n  /**\r\n   * Constructor\r\n   */\n  function ColumnSeries() {\n    var _this = _super.call(this) || this;\n    /**\r\n     * Start location within cell for columns.\r\n     */\n    _this._startLocation = 0;\n    /**\r\n     * End location within cell for columns.\r\n     */\n    _this._endLocation = 1;\n    _this.className = \"ColumnSeries\";\n    _this.width = percent(100);\n    _this.height = percent(100);\n    _this.strokeOpacity = 0;\n    _this.fillOpacity = 1;\n    _this.clustered = true;\n    var columnsContainer = _this.mainContainer.createChild(Container);\n    columnsContainer.shouldClone = false;\n    columnsContainer.isMeasured = false;\n    columnsContainer.layout = \"none\";\n    _this._columnsContainer = columnsContainer;\n    _this.columns.template.pixelPerfect = false;\n    _this.tooltipColorSource = _this.columns.template;\n    _this.applyTheme();\n    return _this;\n  }\n  Object.defineProperty(ColumnSeries.prototype, \"columnsContainer\", {\n    /**\r\n     * A container that columns are created in.\r\n     *\r\n     * @ignore Exclude from docs\r\n     */\n    get: function () {\n      return this._columnsContainer;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Sets defaults that instantiate some objects that rely on parent, so they\r\n   * cannot be set in constructor.\r\n   */\n  ColumnSeries.prototype.applyInternalDefaults = function () {\n    _super.prototype.applyInternalDefaults.call(this);\n    if (!$type.hasValue(this.readerTitle)) {\n      this.readerTitle = this.language.translate(\"Column Series\");\n    }\n  };\n  /**\r\n   * Returns a new/empty DataItem of the type appropriate for this object.\r\n   *\r\n   * @see {@link DataItem}\r\n   * @return Data Item\r\n   */\n  ColumnSeries.prototype.createDataItem = function () {\n    return new ColumnSeriesDataItem();\n  };\n  /**\r\n   * (Re)validates the whole series, effectively causing it to redraw.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n  ColumnSeries.prototype.validate = function () {\n    //@todo Check if we can do better than use `instanceof`\n    // find start/end locations based on clustered/stacked settings\n    // go through chart series instead of base axis series, because axis series doesn't maintain order\n    var _this = this;\n    this.group.node.removeAttribute(\"fill\");\n    if (this.chart && this.xAxis && this.yAxis) {\n      var baseAxisSeries = this.chart.series;\n      var clusterCount_1 = 0;\n      var index_1 = 0;\n      var sortedByAxis_1 = [];\n      $iter.each(baseAxisSeries.iterator(), function (series) {\n        if (series instanceof ColumnSeries) {\n          if (_this.baseAxis == series.baseAxis) {\n            var index_2;\n            if (_this.baseAxis == _this.xAxis) {\n              index_2 = _this.chart.yAxes.indexOf(series.yAxis);\n            } else {\n              index_2 = _this.chart.xAxes.indexOf(series.xAxis);\n            }\n            sortedByAxis_1.push({\n              series: series,\n              axis: index_2\n            });\n          }\n        }\n      });\n      sortedByAxis_1.sort(function (a, b) {\n        return a.axis - b.axis;\n      });\n      var prevAxisIndex_1;\n      $array.each(sortedByAxis_1, function (sortedItem) {\n        var series = sortedItem.series;\n        if (series instanceof ColumnSeries) {\n          if (!series.stacked && series.clustered || prevAxisIndex_1 != sortedItem.axis && series.clustered) {\n            clusterCount_1++;\n          }\n          if (series == _this) {\n            index_1 = clusterCount_1 - 1;\n          }\n        }\n        prevAxisIndex_1 = sortedItem.axis;\n      });\n      if (!this.clustered) {\n        index_1 = 0;\n        clusterCount_1 = 1;\n      }\n      var renderer = this.baseAxis.renderer;\n      var cellStartLocation = renderer.cellStartLocation;\n      var cellEndLocation = renderer.cellEndLocation;\n      this._startLocation = cellStartLocation + index_1 / clusterCount_1 * (cellEndLocation - cellStartLocation);\n      this._endLocation = cellStartLocation + (index_1 + 1) / clusterCount_1 * (cellEndLocation - cellStartLocation);\n      var xAxis = this.xAxis;\n      var yAxis = this.yAxis;\n      if (xAxis instanceof CategoryAxis && yAxis instanceof ValueAxis) {\n        if (xAxis.sortBySeries == this) {\n          this.sortCategoryAxis(xAxis, \"valueY\");\n        }\n      }\n      if (yAxis instanceof CategoryAxis && xAxis instanceof ValueAxis) {\n        if (yAxis.sortBySeries == this) {\n          this.sortCategoryAxis(yAxis, \"valueX\");\n        }\n      }\n    }\n    _super.prototype.validate.call(this);\n    for (var i = 0; i < this.startIndex; i++) {\n      var dataItem = this.dataItems.getIndex(i);\n      this.disableUnusedColumns(dataItem);\n    }\n    for (var i = this.dataItems.length - 1; i > this.endIndex; i--) {\n      var dataItem = this.dataItems.getIndex(i);\n      this.disableUnusedColumns(dataItem);\n    }\n    this._propertiesChanged = false;\n  };\n  ColumnSeries.prototype.sortCategoryAxis = function (axis, key) {\n    var _this = this;\n    this.dataItems.values.sort(function (x, y) {\n      return y.values[key].workingValue - x.values[key].workingValue;\n    });\n    var i = 0;\n    this.dataItems.each(function (dataItem) {\n      dataItem._index = i;\n      i++;\n    });\n    axis.dataItems.each(function (dataItem) {\n      var axis = dataItem.component;\n      var currentPosition = axis.categoryToPosition(dataItem.category) - dataItem.deltaPosition;\n      var seriesDataItem = axis.getSeriesDataItemByCategory(dataItem.category, _this);\n      if (seriesDataItem) {\n        var index = _this.dataItems.indexOf(seriesDataItem);\n        dataItem._index = index;\n        var deltaPosition = $math.round((index + 0.5) / _this.dataItems.length - currentPosition, 3);\n        if (dataItem.deltaAnimation && !dataItem.deltaAnimation.isDisposed() && dataItem.deltaAnimation.animationOptions[0].to == deltaPosition) {\n          // void\n        } else if (deltaPosition != $math.round(dataItem.deltaPosition, 3)) {\n          if (dataItem.deltaAnimation) {\n            dataItem.deltaAnimation.stop();\n          }\n          dataItem.deltaAnimation = dataItem.animate({\n            property: \"deltaPosition\",\n            from: -deltaPosition,\n            to: 0\n          }, axis.interpolationDuration, axis.interpolationEasing);\n          _this._disposers.push(dataItem.deltaAnimation);\n        }\n      }\n    });\n    axis.dataItems.values.sort(function (x, y) {\n      return x.index - y.index;\n    });\n  };\n  /**\r\n   * Validates data item's element, effectively redrawing it.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param dataItem  Data item\r\n   */\n  ColumnSeries.prototype.validateDataElement = function (dataItem) {\n    // important oder here, first real, then super. we need this to know size\n    if (this.chart && this.xAxis && this.yAxis) {\n      this.validateDataElementReal(dataItem);\n      _super.prototype.validateDataElement.call(this, dataItem);\n    }\n  };\n  /**\r\n   * Returns relative start location for the data item.\r\n   *\r\n   * @param dataItem  Data item\r\n   * @return Location (0-1)\r\n   */\n  ColumnSeries.prototype.getStartLocation = function (dataItem) {\n    var startLocation = this._startLocation;\n    if (this.baseAxis == this.xAxis) {\n      startLocation += dataItem.locations[this.xOpenField] - 0.5;\n    } else {\n      startLocation += dataItem.locations[this.yOpenField] - 0.5;\n    }\n    return startLocation;\n  };\n  /**\r\n   * [handleDataItemWorkingValueChange description]\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n  /*\r\n  public handleDataItemWorkingValueChange(dataItem?: this[\"_dataItem\"], name?: string): void {\r\n     if (this.simplifiedProcessing) {\r\n         this.validateDataElement(dataItem);\r\n     }\r\n     else {\r\n         super.handleDataItemWorkingValueChange(dataItem, name);\r\n     }\r\n  }*/\n  /**\r\n   * Returns relative end location for the data item.\r\n   *\r\n   * @param dataItem  Data item\r\n   * @return Location (0-1)\r\n   */\n  ColumnSeries.prototype.getEndLocation = function (dataItem) {\n    var endLocation = this._endLocation;\n    if (this.baseAxis == this.xAxis) {\n      endLocation += dataItem.locations[this.xField] - 0.5;\n    } else {\n      endLocation += dataItem.locations[this.yField] - 0.5;\n    }\n    return endLocation;\n  };\n  /**\r\n   * Validates data item's elements.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param dataItem  Data item\r\n   */\n  ColumnSeries.prototype.validateDataElementReal = function (dataItem) {\n    var _this = this;\n    //\tif (dataItem.hasValue([this.xField, this.yField])) { // todo: this doesn't work with categories, think of a better way\n    var l;\n    var r;\n    var t;\n    var b;\n    var startLocation = this.getStartLocation(dataItem);\n    var endLocation = this.getEndLocation(dataItem);\n    var xField = this.xField;\n    var xOpenField = this.xOpenField;\n    var yField = this.yField;\n    var yOpenField = this.yOpenField;\n    var template = this.columns.template;\n    var percentWidth = template.percentWidth;\n    var percentHeight = template.percentHeight;\n    var pixelWidth = template.pixelWidth;\n    var pixelHeight = template.pixelHeight;\n    var maxWidth = template.maxWidth;\n    var maxHeight = template.maxHeight;\n    var paddingLeft = template.pixelPaddingLeft;\n    var paddingRight = template.pixelPaddingRight;\n    var paddingTop = template.pixelPaddingTop;\n    var paddingBottom = template.pixelPaddingBottom;\n    var outOfBounds = false;\n    var diw = dataItem.width;\n    if ($type.hasValue(diw)) {\n      if ($type.isNumber(diw)) {\n        pixelWidth = diw;\n      }\n      if (diw instanceof Percent) {\n        percentWidth = diw.value * 100;\n      }\n    }\n    var dih = dataItem.height;\n    if ($type.hasValue(dih)) {\n      if ($type.isNumber(dih)) {\n        pixelHeight = dih;\n      }\n      if (dih instanceof Percent) {\n        percentHeight = dih.value * 100;\n      }\n    }\n    // two category axes\n    if (this.xAxis instanceof CategoryAxis && this.yAxis instanceof CategoryAxis) {\n      if (!dataItem.hasValue(this._xValueFields) || !dataItem.hasValue(this._yValueFields)) {\n        return;\n      }\n      startLocation = 0;\n      endLocation = 1;\n      if (!$type.isNaN(percentWidth)) {\n        var offset = $math.round((endLocation - startLocation) * (1 - percentWidth / 100) / 2, 5);\n        startLocation += offset;\n        endLocation -= offset;\n      }\n      l = this.xAxis.getX(dataItem, xOpenField, startLocation);\n      r = this.xAxis.getX(dataItem, xField, endLocation);\n      // in case width is set in pixels\n      if ($type.isNaN(percentWidth)) {\n        var offset = (r - l - pixelWidth) / 2;\n        l += offset;\n        r -= offset;\n      }\n      // in case max width is set in pixels\n      if (!$type.isNaN(maxWidth) && maxWidth < Math.abs(r - l)) {\n        var offset = (r - l - maxWidth) / 2;\n        l += offset;\n        r -= offset;\n      }\n      startLocation = 0;\n      endLocation = 1;\n      if (!$type.isNaN(percentHeight)) {\n        var offset = $math.round((1 - percentHeight / 100) / 2, 5);\n        startLocation += offset;\n        endLocation -= offset;\n      }\n      t = this.yAxis.getY(dataItem, yOpenField, startLocation);\n      b = this.yAxis.getY(dataItem, yField, endLocation);\n      // in case width is set in pixels\n      if ($type.isNaN(percentHeight)) {\n        var offset = (b - t - pixelHeight) / 2;\n        b += offset;\n        t -= offset;\n      }\n      // in case max width is set in pixels\n      if (!$type.isNaN(maxHeight) && maxHeight < Math.abs(b - t)) {\n        var offset = (b - t - maxHeight) / 2;\n        b += offset;\n        t -= offset;\n      }\n      r = this.fixHorizontalCoordinate(r);\n      l = this.fixHorizontalCoordinate(l);\n      t = this.fixVerticalCoordinate(t);\n      b = this.fixVerticalCoordinate(b);\n    } else if (this.baseAxis == this.xAxis) {\n      if (!dataItem.hasValue(this._yValueFields)) {\n        return;\n      }\n      // in case width is set in percent\n      if (!$type.isNaN(percentWidth)) {\n        var offset = $math.round((endLocation - startLocation) * (1 - percentWidth / 100) / 2, 5);\n        startLocation += offset;\n        endLocation -= offset;\n      }\n      l = this.xAxis.getX(dataItem, xOpenField, startLocation);\n      r = this.xAxis.getX(dataItem, xField, endLocation);\n      // in case width is set in pixels\n      if ($type.isNaN(percentWidth)) {\n        var offset = (r - l - pixelWidth) / 2;\n        l += offset;\n        r -= offset;\n      }\n      // in case width is set in pixels\n      if (!$type.isNaN(maxWidth) && maxWidth < Math.abs(r - l)) {\n        var offset = (r - l - maxWidth) / 2;\n        l += offset;\n        r -= offset;\n      }\n      var bottomLocation = dataItem.locations[yOpenField];\n      var topLocation = dataItem.locations[yField];\n      // otherwise gantt chart will start items in the middle of a cell\n      if (this.yAxis instanceof ValueAxis) {\n        if (this.dataFields[this.yField] != this.dataFields[this.yOpenField]) {\n          bottomLocation = 0;\n          topLocation = 0;\n        }\n      }\n      b = this.yAxis.getY(dataItem, yOpenField, bottomLocation);\n      t = this.yAxis.getY(dataItem, yField, topLocation);\n      // used to save location for bullets, but it's not a good approach\n      // dataItem.locations[xField] = startLocation + (endLocation - startLocation) / 2;\n      var axisLenght = Math.ceil(this.yAxis.axisLength);\n      if (t < 0 && b < 0 || t > axisLenght && b > axisLenght) {\n        outOfBounds = true;\n      }\n      t = this.fixVerticalCoordinate(t);\n      b = this.fixVerticalCoordinate(b);\n      if (Math.abs(r - l) - paddingLeft - paddingRight == 0) {\n        outOfBounds = true;\n      }\n    }\n    // horizontal bars\n    else {\n      if (!dataItem.hasValue(this._xValueFields)) {\n        return;\n      }\n      if (!$type.isNaN(percentHeight)) {\n        var offset = $math.round((endLocation - startLocation) * (1 - percentHeight / 100) / 2, 5);\n        startLocation += offset;\n        endLocation -= offset;\n      }\n      t = this.yAxis.getY(dataItem, yOpenField, startLocation);\n      b = this.yAxis.getY(dataItem, yField, endLocation);\n      // in case height is set in pixels\n      if ($type.isNaN(percentHeight)) {\n        var offset = (b - t - pixelHeight) / 2;\n        b -= offset;\n        t += offset;\n      }\n      // in case height is set in pixels\n      if (!$type.isNaN(maxHeight) && maxHeight < Math.abs(b - t)) {\n        var offset = (b - t - maxHeight) / 2;\n        b -= offset;\n        t += offset;\n      }\n      var rightLocation = dataItem.locations[xField];\n      var leftLocation = dataItem.locations[xOpenField];\n      // otherwise gantt chart will start items in the middle of a cell\n      if (this.xAxis instanceof ValueAxis) {\n        if (this.dataFields[this.xField] != this.dataFields[this.xOpenField]) {\n          rightLocation = 0;\n          leftLocation = 0;\n        }\n      }\n      r = this.xAxis.getX(dataItem, xField, rightLocation);\n      l = this.xAxis.getX(dataItem, xOpenField, leftLocation);\n      // used to save location for bullets, but it's not a good approach\n      // dataItem.locations[yField] = startLocation + (endLocation - startLocation) / 2;\n      var axisLenght = Math.ceil(this.xAxis.axisLength);\n      if (r < 0 && l < 0 || r > axisLenght && l > axisLenght) {\n        outOfBounds = true;\n      }\n      r = this.fixHorizontalCoordinate(r);\n      l = this.fixHorizontalCoordinate(l);\n      if (Math.abs(t - b) - paddingTop - paddingBottom == 0) {\n        outOfBounds = true;\n      }\n    }\n    var w = Math.abs(r - l);\n    var h = Math.abs(b - t);\n    var x = Math.min(l, r);\n    var y = Math.min(t, b);\n    if (!outOfBounds) {\n      var column_1;\n      if (!dataItem.column) {\n        column_1 = this.columns.create();\n        //$object.forceCopyProperties(this.columns.template, column, visualProperties);\n        $object.copyProperties(this, column_1, visualProperties); // need this because 3d columns are not in the same container\n        $object.copyProperties(this.columns.template, column_1, visualProperties); // second time, no force, so that columns.template would override series properties\n        dataItem.addSprite(column_1);\n        dataItem.column = column_1;\n        column_1.paper = this.paper; // sometimes pattern is not drawn if is set with adapter without this.\n        // accessibility\n        if (this.itemsFocusable()) {\n          if (!$type.hasValue(this.role)) {\n            this.role = \"menu\";\n          }\n          if (!$type.hasValue(column_1.role)) {\n            column_1.role = \"menuitem\";\n          }\n          column_1.focusable = true;\n        } else {\n          if (!$type.hasValue(this.role)) {\n            this.role = \"list\";\n          }\n          if (!$type.hasValue(column_1.role)) {\n            column_1.role = \"listitem\";\n          }\n          column_1.focusable = false;\n        }\n        if (column_1.focusable) {\n          column_1.events.on(\"focus\", function (ev) {\n            column_1.readerTitle = _this.populateString(_this.itemReaderText, dataItem);\n          }, undefined, false);\n          column_1.events.on(\"blur\", function (ev) {\n            column_1.readerTitle = \"\";\n          }, undefined, false);\n        }\n        if (column_1.hoverable) {\n          column_1.events.on(\"over\", function (ev) {\n            column_1.readerTitle = _this.populateString(_this.itemReaderText, dataItem);\n          }, undefined, false);\n          column_1.events.on(\"out\", function (ev) {\n            column_1.readerTitle = \"\";\n          }, undefined, false);\n        }\n        column_1.parent = this.columnsContainer;\n        column_1.virtualParent = this;\n      } else {\n        column_1 = dataItem.column;\n        if (this._propertiesChanged) {\n          $object.copyProperties(this, column_1, visualProperties);\n          $object.copyProperties(this.columns.template, column_1, visualProperties);\n          $array.each(visualProperties, function (property) {\n            column_1[property] = column_1[property];\n          });\n        }\n      }\n      column_1.width = w;\n      column_1.height = h;\n      column_1.x = x;\n      column_1.y = y;\n      column_1.realX = l;\n      column_1.realY = t;\n      column_1.realWidth = r - l;\n      column_1.realHeight = b - t;\n      this.setColumnStates(column_1);\n      if (column_1.invalid) {\n        column_1.validate(); // validate as if it was used previously, it will flicker with previous dimensions\n      }\n\n      column_1.__disabled = false;\n      //column.returnAfterTemp();\n      $iter.each(this.axisRanges.iterator(), function (axisRange) {\n        var rangeColumn = dataItem.rangesColumns.getKey(axisRange.uid);\n        if (!rangeColumn) {\n          rangeColumn = _this.columns.create();\n          //$object.forceCopyProperties(this.columns.template, rangeColumn, visualProperties);\n          $object.copyProperties(axisRange.contents, rangeColumn, visualProperties); // need this because 3d columns are not in the same container\n          dataItem.addSprite(rangeColumn);\n          dataItem.rangesColumns.setKey(axisRange.uid, rangeColumn);\n          rangeColumn.paper = _this.paper; // sometimes pattern is not drawn if is set with adapter without this.\n        }\n\n        rangeColumn.parent = axisRange.contents;\n        rangeColumn.width = w;\n        rangeColumn.height = h;\n        rangeColumn.x = x;\n        rangeColumn.y = y;\n        _this.setColumnStates(rangeColumn);\n        if (rangeColumn.invalid) {\n          rangeColumn.validate(); // validate as if it was used previously, it will flicker with previous dimensions\n        }\n\n        rangeColumn.__disabled = false;\n        //rangeColumn.returnAfterTemp();\n      });\n    } else {\n      this.disableUnusedColumns(dataItem);\n    }\n    dataItem.itemWidth = w;\n    dataItem.itemHeight = h;\n  };\n  /**\r\n   * @ignore\r\n   */\n  ColumnSeries.prototype.disableUnusedColumns = function (dataItem) {\n    if (dataItem) {\n      if (dataItem.column) {\n        // otherwise might flicker when enabling\n        dataItem.column.width = 0;\n        dataItem.column.height = 0;\n        dataItem.column.__disabled = true;\n      }\n      $iter.each(this.axisRanges.iterator(), function (axisRange) {\n        var rangeColumn = dataItem.rangesColumns.getKey(axisRange.uid);\n        if (rangeColumn) {\n          // otherwise might flicker when enabling\n          rangeColumn.width = 0;\n          rangeColumn.height = 0;\n          rangeColumn.__disabled = true;\n        }\n      });\n    }\n  };\n  /**\r\n   * Apply different state/coloring to columns based on the change value.\r\n   *\r\n   * @param sprite  Sprite to apply state to\r\n   * @todo Do not apply accessibility to wicks of the candlesticks\r\n   */\n  ColumnSeries.prototype.setColumnStates = function (sprite) {\n    if (this._dropFromOpenState || this._dropFromPreviousState || this._riseFromOpenState || this._riseFromPreviousState) {\n      var dataItem = sprite.dataItem;\n      if (this.xAxis instanceof ValueAxis || this.yAxis instanceof ValueAxis) {\n        var open_1;\n        var value = void 0;\n        var change = void 0;\n        if (this.baseAxis == this.yAxis) {\n          if (this.xOpenField && this.xField && this.xAxis instanceof ValueAxis) {\n            open_1 = dataItem.getValue(this.xOpenField);\n            value = dataItem.getValue(this.xField);\n          }\n          change = dataItem.getValue(this.xAxis.axisFieldName + \"X\", \"previousChange\");\n        } else {\n          if (this.yOpenField && this.yField && this.yAxis instanceof ValueAxis) {\n            open_1 = dataItem.getValue(this.yOpenField);\n            value = dataItem.getValue(this.yField);\n          }\n          change = dataItem.getValue(this.yAxis.axisFieldName + \"Y\", \"previousChange\");\n        }\n        if (value < open_1) {\n          dataItem.droppedFromOpen = true;\n          sprite.defaultState.copyFrom(this._dropFromOpenState);\n          sprite.setState(this._dropFromOpenState, 0);\n        } else {\n          dataItem.droppedFromOpen = false;\n          sprite.defaultState.copyFrom(this._riseFromOpenState);\n          sprite.setState(this._riseFromOpenState, 0);\n        }\n        if (change < 0) {\n          dataItem.droppedFromPrevious = true;\n          sprite.defaultState.copyFrom(this._dropFromPreviousState);\n          sprite.setState(this._dropFromPreviousState, 0);\n        } else {\n          dataItem.droppedFromPrevious = false;\n          sprite.defaultState.copyFrom(this._riseFromPreviousState);\n          sprite.setState(this._riseFromPreviousState, 0);\n        }\n      }\n    }\n  };\n  Object.defineProperty(ColumnSeries.prototype, \"columns\", {\n    /**\r\n     * A list of column elements in the series.\r\n     *\r\n     * @return Columns\r\n     */\n    get: function () {\n      if (!this._columns) {\n        this._columns = new ListTemplate(this.createColumnTemplate());\n        this._disposers.push(new ListDisposer(this._columns));\n        this._disposers.push(this._columns.template);\n      }\n      return this._columns;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Creates and returns a column element to use as a template.\r\n   *\r\n   * @return Column template\r\n   */\n  ColumnSeries.prototype.createColumnTemplate = function () {\n    return new Column();\n  };\n  Object.defineProperty(ColumnSeries.prototype, \"clustered\", {\n    /**\r\n     * @return Clustered?\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"clustered\");\n    },\n    /**\r\n     * Cluster this series columns?\r\n     *\r\n     * Setting to `false` will make columns overlap with other series.\r\n     *\r\n     * @default true\r\n     * @param value  Clustered?\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"clustered\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ColumnSeries.prototype, \"dropFromOpenState\", {\n    /**\r\n     * @return State\r\n     */\n    get: function () {\n      if (!this._dropFromOpenState) {\n        this._dropFromOpenState = this.states.create(\"dropFromOpenState\");\n      }\n      return this._dropFromOpenState;\n    },\n    /**\r\n     * A state to apply to a column when close value is lower than open value.\r\n     *\r\n     * Can be used to differentiate appearance based on value relations.\r\n     *\r\n     * NOTE: this will work only if at least one axis is [[ValueAxis]].\r\n     *\r\n     * @readonly You can modify state object, but can't overwrite it\r\n     * @param  value  State\r\n     */\n    set: function (value) {\n      this._dropFromOpenState = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ColumnSeries.prototype, \"dropFromPreviousState\", {\n    /**\r\n     * @return State\r\n     */\n    get: function () {\n      if (!this._dropFromPreviousState) {\n        this._dropFromPreviousState = this.states.create(\"dropFromPreviousState\");\n      }\n      return this._dropFromPreviousState;\n    },\n    /**\r\n     * A state to apply to a column when its value is lower value of a previous\r\n     * column.\r\n     *\r\n     * Can be used to differentiate appearance based on value relations.\r\n     *\r\n     * @readonly You can modify state object, but can't overwrite it\r\n     * @param  value  State\r\n     */\n    set: function (value) {\n      this._dropFromPreviousState = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ColumnSeries.prototype, \"riseFromOpenState\", {\n    /**\r\n     * @return State\r\n     */\n    get: function () {\n      if (!this._riseFromOpenState) {\n        this._riseFromOpenState = this.states.create(\"riseFromOpenState\");\n      }\n      return this._riseFromOpenState;\n    },\n    /**\r\n     * A state to apply to a column when close value is same or higher than open\r\n     * value.\r\n     *\r\n     * Can be used to differentiate appearance based on value relations.\r\n     *\r\n     * NOTE: this will work only if at least one axis is [[ValueAxis]].\r\n     *\r\n     * @readonly You can modify state object, but can't overwrite it\r\n     * @param  value  State\r\n     */\n    set: function (value) {\n      this._riseFromOpenState = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ColumnSeries.prototype, \"riseFromPreviousState\", {\n    /**\r\n     * @return State\r\n     */\n    get: function () {\n      if (!this._riseFromPreviousState) {\n        this._riseFromPreviousState = this.states.create(\"riseFromPreviousState\");\n      }\n      return this._riseFromPreviousState;\n    },\n    /**\r\n     * A state to apply to a column when its value is same or higher than value\r\n     * of a previous column.\r\n     *\r\n     * Can be used to differentiate appearance based on value relations.\r\n     *\r\n     * @readonly You can modify state object, but can't overwrite it\r\n     * @param  value  State\r\n     */\n    set: function (value) {\n      this._riseFromPreviousState = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Updates value of the related legend item.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param dataItem  Data item\r\n   */\n  ColumnSeries.prototype.updateLegendValue = function (dataItem, notRange) {\n    var _this = this;\n    _super.prototype.updateLegendValue.call(this, dataItem, notRange);\n    if (this.legendDataItem) {\n      var marker = this.legendDataItem.marker;\n      var fromOpenState_1;\n      var fromPreviousState_1;\n      if (dataItem) {\n        if (dataItem.droppedFromOpen) {\n          fromOpenState_1 = this._dropFromOpenState;\n        } else {\n          fromOpenState_1 = this._riseFromOpenState;\n        }\n        if (dataItem.droppedFromPrevious) {\n          fromPreviousState_1 = this._dropFromPreviousState;\n        } else {\n          fromPreviousState_1 = this._riseFromPreviousState;\n        }\n      }\n      $iter.each(marker.children.iterator(), function (child) {\n        if (dataItem) {\n          child.setState(fromPreviousState_1);\n          child.setState(fromOpenState_1);\n        } else {\n          // todo: think what to do here, maybe apply above states based on totals?\n          child.setState(_this._riseFromPreviousState);\n          child.setState(_this._riseFromOpenState);\n        }\n      });\n    }\n  };\n  /**\r\n   * Creates elements in related legend container, that mimics the look of this\r\n   * Series.\r\n   *\r\n   * @ignore Exclude from docs\r\n   * @param marker  Legend item container\r\n   */\n  ColumnSeries.prototype.createLegendMarker = function (marker) {\n    var w = marker.pixelWidth;\n    var h = marker.pixelHeight;\n    marker.removeChildren();\n    var column = marker.createChild(RoundedRectangle);\n    column.shouldClone = false;\n    $object.copyProperties(this, column, visualProperties);\n    column.copyFrom(this.columns.template);\n    column.padding(0, 0, 0, 0); // if columns will have padding (which is often), legend marker will be very narrow\n    column.width = w;\n    column.height = h;\n    var legendDataItem = marker.dataItem;\n    legendDataItem.color = this.fill;\n    legendDataItem.colorOrig = this.fill;\n  };\n  /**\r\n   * Copies all properties from another instance of [[ColumnSeries]].\r\n   *\r\n   * @param source  Source series\r\n   */\n  ColumnSeries.prototype.copyFrom = function (source) {\n    _super.prototype.copyFrom.call(this, source);\n    this.columns.template.copyFrom(source.columns.template);\n  };\n  /**\r\n  * returns bullet x location\r\n  * @ignore\r\n  */\n  ColumnSeries.prototype.getBulletLocationX = function (bullet, field) {\n    if (this.baseAxis == this.xAxis) {\n      var bulletLocationX = bullet.locationX;\n      if (!$type.isNumber(bulletLocationX)) {\n        bulletLocationX = 0.5;\n      }\n      var endLocation = this.getEndLocation(bullet.dataItem);\n      var startLocation = this.getStartLocation(bullet.dataItem);\n      return endLocation - (endLocation - startLocation) * bulletLocationX;\n    } else {\n      return _super.prototype.getBulletLocationX.call(this, bullet, field);\n    }\n  };\n  /**\r\n  * returns bullet y location\r\n  * @ignore\r\n  */\n  ColumnSeries.prototype.getBulletLocationY = function (bullet, field) {\n    if (this.baseAxis == this.yAxis) {\n      var bulletLocationY = bullet.locationY;\n      if (!$type.isNumber(bulletLocationY)) {\n        bulletLocationY = 0.5;\n      }\n      var endLocation = this.getEndLocation(bullet.dataItem);\n      var startLocation = this.getStartLocation(bullet.dataItem);\n      return endLocation - (endLocation - startLocation) * bulletLocationY;\n    } else {\n      return _super.prototype.getBulletLocationY.call(this, bullet, field);\n    }\n  };\n  ColumnSeries.prototype.getAdjustedXLocation = function (dataItem, field, bulletLocationX) {\n    //if (this.baseAxis == this.xAxis) {\n    if (!$type.isNumber(bulletLocationX)) {\n      if (dataItem) {\n        bulletLocationX = dataItem.locations[field];\n      } else {\n        bulletLocationX = 0.5;\n      }\n    }\n    return this._endLocation - (this._endLocation - this._startLocation) * (1 - bulletLocationX);\n    //}\n    //else {\n    //\treturn super.getAdjustedXLocation(dataItem, field);\n    //}\n  };\n\n  ColumnSeries.prototype.getAdjustedYLocation = function (dataItem, field, bulletLocationY) {\n    //if (this.baseAxis == this.yAxis) {\n    if (!$type.isNumber(bulletLocationY)) {\n      if (dataItem) {\n        bulletLocationY = dataItem.locations[field];\n      } else {\n        bulletLocationY = 0.5;\n      }\n    }\n    return this._endLocation - (this._endLocation - this._startLocation) * bulletLocationY;\n    //}\n    //else {\n    //\treturn super.getAdjustedYLocation(dataItem, field);\n    //}\n  };\n  /**\r\n   * @ignore Exclude from docs\r\n   */\n  ColumnSeries.prototype.fixVerticalCoordinate = function (coordinate) {\n    var paddingBottom = this.columns.template.pixelPaddingBottom;\n    var paddingTop = this.columns.template.pixelPaddingTop;\n    var minY = -paddingTop;\n    var maxY = this.yAxis.axisLength + paddingBottom;\n    return $math.fitToRange(coordinate, minY, maxY);\n  };\n  /**\r\n   * @ignore Exclude from docs\r\n   */\n  ColumnSeries.prototype.fixHorizontalCoordinate = function (coordinate) {\n    var paddingLeft = this.columns.template.pixelPaddingLeft;\n    var paddingRight = this.columns.template.pixelPaddingRight;\n    var minX = -paddingLeft;\n    var maxX = this.xAxis.axisLength + paddingRight;\n    return $math.fitToRange(coordinate, minX, maxX);\n  };\n  /**\r\n   * @ignore\r\n   */\n  ColumnSeries.prototype.disposeData = function () {\n    _super.prototype.disposeData.call(this);\n    this.columns.clear();\n  };\n  return ColumnSeries;\n}(XYSeries);\nexport { ColumnSeries };\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\nregistry.registeredClasses[\"ColumnSeries\"] = ColumnSeries;\nregistry.registeredClasses[\"ColumnSeriesDataItem\"] = ColumnSeriesDataItem;","map":{"version":3,"mappings":"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","names":["XYSeries","XYSeriesDataItem","visualProperties","Container","ListTemplate","ListDisposer","Dictionary","ValueAxis","CategoryAxis","registry","Column","RoundedRectangle","percent","Percent","$math","$object","$iter","$array","$type","Disposer","__extends","_super","_this","className","locations","applyTheme","Object","ColumnSeriesDataItem","_column","column","setColumn","remove","sprites","prevDataItem","dataItem","undefined","addSprite","_disposers","push","component","columns","removeValue","width","properties","_adapterO","apply","value","validateDataElement","height","_rangesColumns","strokeOpacity","fillOpacity","clustered","columnsContainer","mainContainer","createChild","shouldClone","isMeasured","layout","_columnsContainer","template","pixelPerfect","tooltipColorSource","ColumnSeries","applyInternalDefaults","hasValue","readerTitle","language","translate","group","node","removeAttribute","chart","xAxis","yAxis","baseAxisSeries","series","clusterCount_1","index_1","sortedByAxis_1","each","iterator","baseAxis","index_2","yAxes","indexOf","xAxes","axis","sort","a","b","prevAxisIndex_1","sortedItem","stacked","renderer","cellStartLocation","cellEndLocation","_startLocation","_endLocation","sortBySeries","sortCategoryAxis","validate","i","startIndex","dataItems","getIndex","disableUnusedColumns","length","endIndex","_propertiesChanged","key","values","x","y","workingValue","_index","currentPosition","categoryToPosition","category","deltaPosition","seriesDataItem","getSeriesDataItemByCategory","index","round","deltaAnimation","isDisposed","animationOptions","to","stop","animate","property","from","interpolationDuration","interpolationEasing","validateDataElementReal","startLocation","xOpenField","yOpenField","endLocation","xField","yField","l","r","t","getStartLocation","getEndLocation","percentWidth","percentHeight","pixelWidth","pixelHeight","maxWidth","maxHeight","paddingLeft","pixelPaddingLeft","paddingRight","pixelPaddingRight","paddingTop","pixelPaddingTop","paddingBottom","pixelPaddingBottom","outOfBounds","diw","isNumber","dih","_xValueFields","_yValueFields","isNaN","offset","getX","Math","abs","getY","fixHorizontalCoordinate","fixVerticalCoordinate","bottomLocation","topLocation","dataFields","axisLenght","ceil","axisLength","rightLocation","leftLocation","w","h","min","column_1","create","copyProperties","paper","itemsFocusable","role","focusable","events","on","ev","populateString","itemReaderText","hoverable","parent","virtualParent","realX","realY","realWidth","realHeight","setColumnStates","invalid","__disabled","axisRanges","axisRange","rangeColumn","rangesColumns","getKey","uid","contents","setKey","itemWidth","itemHeight","sprite","_dropFromOpenState","_dropFromPreviousState","_riseFromOpenState","_riseFromPreviousState","open_1","change","getValue","axisFieldName","droppedFromOpen","defaultState","copyFrom","setState","droppedFromPrevious","_columns","createColumnTemplate","getPropertyValue","setPropertyValue","states","notRange","updateLegendValue","legendDataItem","marker","fromOpenState_1","fromPreviousState_1","children","child","removeChildren","padding","color","fill","colorOrig","source","bullet","field","bulletLocationX","locationX","getBulletLocationX","bulletLocationY","locationY","getBulletLocationY","coordinate","minY","maxY","fitToRange","minX","maxX","disposeData","clear","registeredClasses"],"sources":["C:\\Users\\Lucian\\Documents\\DEV\\nodejs\\stock-market-api\\dev\\static\\node_modules\\src\\.internal\\charts\\series\\ColumnSeries.ts"],"sourcesContent":["/**\r\n * Column series module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { XYSeries, IXYSeriesDataFields, XYSeriesDataItem, IXYSeriesProperties, IXYSeriesAdapters, IXYSeriesEvents } from \"./XYSeries\";\r\nimport { Sprite, visualProperties } from \"../../core/Sprite\";\r\nimport { SpriteState } from \"../../core/SpriteState\";\r\nimport { Container } from \"../../core/Container\";\r\nimport { ListTemplate, ListDisposer } from \"../../core/utils/List\";\r\nimport { Dictionary } from \"../../core/utils/Dictionary\";\r\nimport { ValueAxis } from \"../axes/ValueAxis\";\r\nimport { CategoryAxis } from \"../axes/CategoryAxis\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { Bullet } from \"../elements/Bullet\";\r\nimport { Column } from \"../elements/Column\";\r\nimport { RoundedRectangle } from \"../../core/elements/RoundedRectangle\";\r\nimport { percent, Percent } from \"../../core/utils/Percent\";\r\nimport * as $math from \"../../core/utils/Math\";\r\nimport * as $object from \"../../core/utils/Object\";\r\nimport * as $iter from \"../../core/utils/Iterator\";\r\nimport * as $array from \"../../core/utils/Array\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport { Disposer } from \"../../core/utils/Disposer\";\r\nimport { LegendDataItem } from \"../../charts/Legend\";\r\nimport { IDataItemAdapters } from \"../../core/DataItem\";\r\n\r\n/**\r\n * Defines adapters for [[DataItem]]\r\n * Includes both the [[Adapter]] definitions and properties\r\n * @see {@link Adapter}\r\n */\r\nexport interface IColumnSeriesDataItemAdapters extends IDataItemAdapters {\r\n\twidth: number | Percent;\r\n\theight: number | Percent;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a [[DataItem]] for [[ColumnSeries]].\r\n *\r\n * @see {@link DataItem}\r\n */\r\nexport class ColumnSeriesDataItem extends XYSeriesDataItem {\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IColumnSeriesDataItemAdapters;\r\n\r\n\t/**\r\n\t * A Column Element\r\n\t */\r\n\tpublic _column: Column;\r\n\r\n\t/**\r\n\t * Indicates if this data items close value is lower than its open value.\r\n\t */\r\n\tpublic droppedFromOpen: boolean;\r\n\r\n\t/**\r\n\t * Indicates if this items value is lower than previous data item's value.\r\n\t */\r\n\tpublic droppedFromPrevious: boolean;\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this data item is used for\r\n\t */\r\n\tpublic _component!: ColumnSeries;\r\n\r\n\t/**\r\n\t * A dictionary storing axes ranges columns by axis uid\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tprotected _rangesColumns: Dictionary<string, this[\"_column\"]>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"ColumnSeriesDataItem\";\r\n\r\n\t\tthis.locations[\"dateX\"] = 0.5;\r\n\t\tthis.locations[\"dateY\"] = 0.5;\r\n\r\n\t\tthis.locations[\"categoryX\"] = 0.5;\r\n\t\tthis.locations[\"categoryY\"] = 0.5;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * A column used to draw a column for this data item.\r\n\t *\r\n\t * @param column\r\n\t */\r\n\tpublic set column(column: this[\"_column\"]) {\r\n\t\tthis.setColumn(column);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Column\r\n\t */\r\n\tpublic get column(): this[\"_column\"] {\r\n\t\treturn this._column;\r\n\t}\r\n\r\n\tprotected setColumn(column: this[\"_column\"]) {\r\n\t\tif (this._column && column != this._column) {\r\n\t\t\t$array.remove(this.sprites, this._column);\r\n\t\t}\r\n\t\tthis._column = column;\r\n\r\n\t\tif (column) {\r\n\t\t\tlet prevDataItem: ColumnSeriesDataItem = <any>column.dataItem;\r\n\t\t\tif (prevDataItem && prevDataItem != this) {\r\n\t\t\t\tprevDataItem.column = undefined;\r\n\t\t\t}\r\n\t\t\tthis.addSprite(column);\r\n\r\n\t\t\tthis._disposers.push(new Disposer(() => {\r\n\t\t\t\t// TODO investigate why component is undefined\r\n\t\t\t\t// https://codepen.io/team/amcharts/pen/dac4be245d658233a6d7e5597df2208b?editors=0010\r\n\t\t\t\tif (this.component) {\r\n\t\t\t\t\tthis.component.columns.removeValue(column);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tpublic set width(value: number | Percent) {\r\n\t\tif (this.properties.width != value) {\r\n\t\t\tthis.properties.width = value;\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.validateDataElement(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get width(): number | Percent {\r\n\t\tlet width = this.properties.width;\r\n\t\tif (this._adapterO) {\r\n\t\t\twidth = this._adapterO.apply(\"width\", width);\r\n\t\t}\r\n\t\treturn width;\r\n\t}\r\n\r\n\r\n\tpublic set height(value: number | Percent) {\r\n\t\tif (this.properties.height != value) {\r\n\t\t\tthis.properties.height = value;\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.validateDataElement(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get height(): number | Percent {\r\n\t\tlet height = this.properties.height;\r\n\t\tif (this._adapterO) {\r\n\t\t\theight = this._adapterO.apply(\"height\", height);\r\n\t\t}\r\n\t\treturn height;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * A dictionary storing axes ranges columns by axis uid\r\n\t */\r\n\tpublic get rangesColumns(): Dictionary<string, this[\"_column\"]> {\r\n\t\tif (!this._rangesColumns) {\r\n\t\t\tthis._rangesColumns = new Dictionary<string, this[\"_column\"]>();\r\n\t\t}\r\n\t\treturn this._rangesColumns;\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines data fields for [[XYSeries]].\r\n */\r\nexport interface IColumnSeriesDataFields extends IXYSeriesDataFields {\r\n\twidth?: string;\r\n}\r\n\r\n/**\r\n * Defines properties for [[ColumnSeries]].\r\n */\r\nexport interface IColumnSeriesProperties extends IXYSeriesProperties {\r\n\r\n\t/**\r\n\t * Cluster this series columns?\r\n\t *\r\n\t * Setting to `false` will make columns overlap with other series.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tclustered?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[ColumnSeries]].\r\n */\r\nexport interface IColumnSeriesEvents extends IXYSeriesEvents { }\r\n\r\n/**\r\n * Defines adapters for [[ColumnSeries]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IColumnSeriesAdapters extends IXYSeriesAdapters, IColumnSeriesProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines [[Series]] for a column graph.\r\n *\r\n * @see {@link IColumnSeriesEvents} for a list of available Events\r\n * @see {@link IColumnSeriesAdapters} for a list of available Adapters\r\n * @todo Example\r\n * @important\r\n */\r\nexport class ColumnSeries extends XYSeries {\r\n\r\n\t/**\r\n\t * Type of column.\r\n\t */\r\n\tpublic _column: Column;\r\n\r\n\t/**\r\n\t * Defines available data fields.\r\n\t */\r\n\tpublic _dataFields: IColumnSeriesDataFields;\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IColumnSeriesProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IColumnSeriesAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IColumnSeriesEvents;\r\n\r\n\t/**\r\n\t * Defines the type of data item.\r\n\t */\r\n\tpublic _dataItem: ColumnSeriesDataItem;\r\n\r\n\t/**\r\n\t * A list of column elements.\r\n\t */\r\n\tprotected _columns: ListTemplate<this[\"_column\"]>;\r\n\r\n\t/**\r\n\t * Container to put column elements in.\r\n\t */\r\n\tprotected _columnsContainer: Container;\r\n\r\n\t/**\r\n\t * Start location within cell for columns.\r\n\t */\r\n\tprotected _startLocation: number = 0;\r\n\r\n\t/**\r\n\t * End location within cell for columns.\r\n\t */\r\n\tprotected _endLocation: number = 1;\r\n\r\n\t/**\r\n\t * A state to apply to a column when close value is lower than open value.\r\n\t */\r\n\tprotected _dropFromOpenState: SpriteState<this[\"_properties\"], this[\"_adapter\"]>;\r\n\r\n\t/**\r\n\t * A state to apply to a column when its value is lower value of a previous\r\n\t * column.\r\n\t */\r\n\tprotected _dropFromPreviousState: SpriteState<this[\"_properties\"], this[\"_adapter\"]>;\r\n\r\n\t/**\r\n\t * A state to apply to a column when close value is same or higher than open\r\n\t * value.\r\n\t */\r\n\tprotected _riseFromOpenState: SpriteState<this[\"_properties\"], this[\"_adapter\"]>;\r\n\r\n\t/**\r\n\t * A state to apply to a column when its value is same or higher than value\r\n\t * of a previous column.\r\n\t */\r\n\tprotected _riseFromPreviousState: SpriteState<this[\"_properties\"], this[\"_adapter\"]>;\r\n\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"ColumnSeries\";\r\n\r\n\t\tthis.width = percent(100);\r\n\t\tthis.height = percent(100);\r\n\r\n\t\tthis.strokeOpacity = 0;\r\n\t\tthis.fillOpacity = 1;\r\n\r\n\t\tthis.clustered = true;\r\n\r\n\t\tlet columnsContainer = this.mainContainer.createChild(Container);\r\n\t\tcolumnsContainer.shouldClone = false;\r\n\t\tcolumnsContainer.isMeasured = false;\r\n\t\tcolumnsContainer.layout = \"none\";\r\n\t\tthis._columnsContainer = columnsContainer;\r\n\r\n\t\tthis.columns.template.pixelPerfect = false;\r\n\r\n\t\tthis.tooltipColorSource = this.columns.template;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * A container that columns are created in.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic get columnsContainer() {\r\n\t\treturn this._columnsContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets defaults that instantiate some objects that rely on parent, so they\r\n\t * cannot be set in constructor.\r\n\t */\r\n\tprotected applyInternalDefaults(): void {\r\n\t\tsuper.applyInternalDefaults();\r\n\t\tif (!$type.hasValue(this.readerTitle)) {\r\n\t\t\tthis.readerTitle = this.language.translate(\"Column Series\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new ColumnSeriesDataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates the whole series, effectively causing it to redraw.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\t//@todo Check if we can do better than use `instanceof`\r\n\t\t// find start/end locations based on clustered/stacked settings\r\n\t\t// go through chart series instead of base axis series, because axis series doesn't maintain order\r\n\r\n\t\tthis.group.node.removeAttribute(\"fill\");\r\n\r\n\t\tif (this.chart && this.xAxis && this.yAxis) {\r\n\t\t\tlet baseAxisSeries = this.chart.series;\r\n\t\t\tlet clusterCount: number = 0;\r\n\t\t\tlet index: number = 0;\r\n\r\n\t\t\tlet sortedByAxis: { series: XYSeries, axis: number }[] = [];\r\n\t\t\t$iter.each(baseAxisSeries.iterator(), (series) => {\r\n\t\t\t\tif (series instanceof ColumnSeries) {\r\n\t\t\t\t\tif (this.baseAxis == series.baseAxis) {\r\n\t\t\t\t\t\tlet index: number;\r\n\t\t\t\t\t\tif (this.baseAxis == this.xAxis) {\r\n\t\t\t\t\t\t\tindex = this.chart.yAxes.indexOf(series.yAxis);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tindex = this.chart.xAxes.indexOf(series.xAxis);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsortedByAxis.push({ series: series, axis: index })\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\r\n\t\t\tsortedByAxis.sort((a, b) => a.axis - b.axis);\r\n\t\t\tlet prevAxisIndex: number;\r\n\r\n\t\t\t$array.each(sortedByAxis, (sortedItem) => {\r\n\t\t\t\tlet series = sortedItem.series;\r\n\t\t\t\tif (series instanceof ColumnSeries) {\r\n\t\t\t\t\tif ((!series.stacked && series.clustered) || (prevAxisIndex != sortedItem.axis && series.clustered)) {\r\n\t\t\t\t\t\tclusterCount++;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (series == this) {\r\n\t\t\t\t\t\tindex = clusterCount - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tprevAxisIndex = sortedItem.axis;\r\n\t\t\t});\r\n\r\n\t\t\tif (!this.clustered) {\r\n\t\t\t\tindex = 0;\r\n\t\t\t\tclusterCount = 1;\r\n\t\t\t}\r\n\r\n\t\t\tlet renderer = this.baseAxis.renderer;\r\n\r\n\t\t\tlet cellStartLocation: number = renderer.cellStartLocation;\r\n\t\t\tlet cellEndLocation: number = renderer.cellEndLocation;\r\n\r\n\t\t\tthis._startLocation = cellStartLocation + (index / clusterCount) * (cellEndLocation - cellStartLocation);\r\n\t\t\tthis._endLocation = cellStartLocation + (index + 1) / clusterCount * (cellEndLocation - cellStartLocation);\r\n\r\n\t\t\tlet xAxis = this.xAxis;\r\n\t\t\tlet yAxis = this.yAxis;\r\n\r\n\t\t\tif (xAxis instanceof CategoryAxis && yAxis instanceof ValueAxis) {\r\n\t\t\t\tif (xAxis.sortBySeries == this) {\r\n\t\t\t\t\tthis.sortCategoryAxis(xAxis, \"valueY\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (yAxis instanceof CategoryAxis && xAxis instanceof ValueAxis) {\r\n\t\t\t\tif (yAxis.sortBySeries == this) {\r\n\t\t\t\t\tthis.sortCategoryAxis(yAxis, \"valueX\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tsuper.validate();\r\n\r\n\t\tfor (let i = 0; i < this.startIndex; i++) {\r\n\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\tthis.disableUnusedColumns(dataItem);\r\n\t\t}\r\n\r\n\t\tfor (let i = this.dataItems.length - 1; i > this.endIndex; i--) {\r\n\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\tthis.disableUnusedColumns(dataItem);\r\n\t\t}\r\n\r\n\t\tthis._propertiesChanged = false;\r\n\t}\r\n\r\n\tprotected sortCategoryAxis(axis: CategoryAxis, key: string) {\r\n\t\tthis.dataItems.values.sort((x, y) => {\r\n\t\t\treturn (<any>y).values[key].workingValue - (<any>x).values[key].workingValue;\r\n\t\t})\r\n\t\tlet i = 0;\r\n\t\tthis.dataItems.each((dataItem) => {\r\n\t\t\tdataItem._index = i;\r\n\t\t\ti++;\r\n\t\t})\r\n\r\n\t\taxis.dataItems.each((dataItem) => {\r\n\t\t\tlet axis = dataItem.component;\r\n\t\t\tlet currentPosition = axis.categoryToPosition(dataItem.category) - dataItem.deltaPosition;\r\n\r\n\t\t\tlet seriesDataItem = axis.getSeriesDataItemByCategory(dataItem.category, this);\r\n\r\n\t\t\tif (seriesDataItem) {\r\n\t\t\t\tlet index = this.dataItems.indexOf(<ColumnSeriesDataItem>seriesDataItem);\r\n\r\n\t\t\t\tdataItem._index = index;\r\n\r\n\t\t\t\tlet deltaPosition = $math.round((index + 0.5) / this.dataItems.length - currentPosition, 3);\r\n\r\n\t\t\t\tif (dataItem.deltaAnimation && !dataItem.deltaAnimation.isDisposed() && dataItem.deltaAnimation.animationOptions[0].to == deltaPosition) {\r\n\t\t\t\t\t// void\r\n\t\t\t\t}\r\n\t\t\t\telse if (deltaPosition != $math.round(dataItem.deltaPosition, 3)) {\r\n\t\t\t\t\tif (dataItem.deltaAnimation) {\r\n\t\t\t\t\t\tdataItem.deltaAnimation.stop();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdataItem.deltaAnimation = dataItem.animate({ property: \"deltaPosition\", from: -deltaPosition, to: 0 }, axis.interpolationDuration, axis.interpolationEasing);\r\n\t\t\t\t\tthis._disposers.push(dataItem.deltaAnimation);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\taxis.dataItems.values.sort((x, y) => {\r\n\t\t\treturn x.index - y.index;\r\n\t\t})\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Validates data item's element, effectively redrawing it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param dataItem  Data item\r\n\t */\r\n\tpublic validateDataElement(dataItem: this[\"_dataItem\"]): void {\r\n\t\t// important oder here, first real, then super. we need this to know size\r\n\t\tif (this.chart && this.xAxis && this.yAxis) {\r\n\t\t\tthis.validateDataElementReal(dataItem);\r\n\t\t\tsuper.validateDataElement(dataItem);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns relative start location for the data item.\r\n\t *\r\n\t * @param dataItem  Data item\r\n\t * @return Location (0-1)\r\n\t */\r\n\tprotected getStartLocation(dataItem: this[\"_dataItem\"]): number {\r\n\t\tlet startLocation = this._startLocation;\r\n\r\n\t\tif (this.baseAxis == this.xAxis) {\r\n\t\t\tstartLocation += dataItem.locations[this.xOpenField] - 0.5;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartLocation += dataItem.locations[this.yOpenField] - 0.5;\r\n\t\t}\r\n\t\treturn startLocation;\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataItemWorkingValueChange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\t/*\r\n   public handleDataItemWorkingValueChange(dataItem?: this[\"_dataItem\"], name?: string): void {\r\n\t   if (this.simplifiedProcessing) {\r\n\t\t   this.validateDataElement(dataItem);\r\n\t   }\r\n\t   else {\r\n\t\t   super.handleDataItemWorkingValueChange(dataItem, name);\r\n\t   }\r\n   }*/\r\n\r\n\t/**\r\n\t * Returns relative end location for the data item.\r\n\t *\r\n\t * @param dataItem  Data item\r\n\t * @return Location (0-1)\r\n\t */\r\n\tprotected getEndLocation(dataItem: this[\"_dataItem\"]): number {\r\n\t\tlet endLocation = this._endLocation;\r\n\r\n\t\tif (this.baseAxis == this.xAxis) {\r\n\t\t\tendLocation += dataItem.locations[this.xField] - 0.5;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tendLocation += dataItem.locations[this.yField] - 0.5;\r\n\t\t}\r\n\t\treturn endLocation;\r\n\t}\r\n\r\n\t/**\r\n\t * Validates data item's elements.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param dataItem  Data item\r\n\t */\r\n\tpublic validateDataElementReal(dataItem: this[\"_dataItem\"]): void {\r\n\t\t//\tif (dataItem.hasValue([this.xField, this.yField])) { // todo: this doesn't work with categories, think of a better way\r\n\t\tlet l: number;\r\n\t\tlet r: number;\r\n\t\tlet t: number;\r\n\t\tlet b: number;\r\n\r\n\t\tlet startLocation = this.getStartLocation(dataItem);\r\n\t\tlet endLocation = this.getEndLocation(dataItem);\r\n\r\n\t\tlet xField = this.xField;\r\n\t\tlet xOpenField = this.xOpenField;\r\n\t\tlet yField = this.yField;\r\n\t\tlet yOpenField = this.yOpenField;\r\n\r\n\t\tlet template: Sprite = this.columns.template;\r\n\r\n\t\tlet percentWidth: number = template.percentWidth;\r\n\t\tlet percentHeight: number = template.percentHeight;\r\n\r\n\t\tlet pixelWidth: number = template.pixelWidth;\r\n\t\tlet pixelHeight: number = template.pixelHeight;\r\n\r\n\t\tlet maxWidth: number = template.maxWidth;\r\n\t\tlet maxHeight: number = template.maxHeight;\r\n\r\n\t\tlet paddingLeft: number = template.pixelPaddingLeft;\r\n\t\tlet paddingRight: number = template.pixelPaddingRight;\r\n\t\tlet paddingTop: number = template.pixelPaddingTop;\r\n\t\tlet paddingBottom: number = template.pixelPaddingBottom;\r\n\r\n\t\tlet outOfBounds: boolean = false;\r\n\r\n\t\tlet diw = dataItem.width;\r\n\t\tif ($type.hasValue(diw)) {\r\n\t\t\tif ($type.isNumber(diw)) {\r\n\t\t\t\tpixelWidth = diw;\r\n\t\t\t}\r\n\t\t\tif (diw instanceof Percent) {\r\n\t\t\t\tpercentWidth = diw.value * 100;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet dih = dataItem.height;\r\n\t\tif ($type.hasValue(dih)) {\r\n\t\t\tif ($type.isNumber(dih)) {\r\n\t\t\t\tpixelHeight = dih;\r\n\t\t\t}\r\n\t\t\tif (dih instanceof Percent) {\r\n\t\t\t\tpercentHeight = dih.value * 100;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// two category axes\r\n\t\tif ((this.xAxis instanceof CategoryAxis) && (this.yAxis instanceof CategoryAxis)) {\r\n\r\n\t\t\tif (!dataItem.hasValue(this._xValueFields) || !dataItem.hasValue(this._yValueFields)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tstartLocation = 0;\r\n\t\t\tendLocation = 1;\r\n\t\t\tif (!$type.isNaN(percentWidth)) {\r\n\t\t\t\tlet offset: number = $math.round((endLocation - startLocation) * (1 - percentWidth / 100) / 2, 5);\r\n\t\t\t\tstartLocation += offset;\r\n\t\t\t\tendLocation -= offset;\r\n\t\t\t}\r\n\r\n\t\t\tl = this.xAxis.getX(dataItem, xOpenField, startLocation);\r\n\t\t\tr = this.xAxis.getX(dataItem, xField, endLocation);\r\n\r\n\t\t\t// in case width is set in pixels\r\n\t\t\tif ($type.isNaN(percentWidth)) {\r\n\t\t\t\tlet offset: number = ((r - l) - pixelWidth) / 2;\r\n\t\t\t\tl += offset;\r\n\t\t\t\tr -= offset;\r\n\t\t\t}\r\n\r\n\t\t\t// in case max width is set in pixels\r\n\t\t\tif (!$type.isNaN(maxWidth) && maxWidth < Math.abs(r - l)) {\r\n\t\t\t\tlet offset: number = ((r - l) - maxWidth) / 2;\r\n\t\t\t\tl += offset;\r\n\t\t\t\tr -= offset;\r\n\t\t\t}\r\n\r\n\t\t\tstartLocation = 0;\r\n\t\t\tendLocation = 1;\r\n\r\n\t\t\tif (!$type.isNaN(percentHeight)) {\r\n\t\t\t\tlet offset: number = $math.round((1 - percentHeight / 100) / 2, 5);\r\n\t\t\t\tstartLocation += offset;\r\n\t\t\t\tendLocation -= offset;\r\n\t\t\t}\r\n\r\n\t\t\tt = this.yAxis.getY(dataItem, yOpenField, startLocation);\r\n\t\t\tb = this.yAxis.getY(dataItem, yField, endLocation);\r\n\r\n\t\t\t// in case width is set in pixels\r\n\t\t\tif ($type.isNaN(percentHeight)) {\r\n\t\t\t\tlet offset: number = ((b - t) - pixelHeight) / 2;\r\n\t\t\t\tb += offset;\r\n\t\t\t\tt -= offset;\r\n\t\t\t}\r\n\r\n\t\t\t// in case max width is set in pixels\r\n\t\t\tif (!$type.isNaN(maxHeight) && maxHeight < Math.abs(b - t)) {\r\n\t\t\t\tlet offset: number = ((b - t) - maxHeight) / 2;\r\n\t\t\t\tb += offset;\r\n\t\t\t\tt -= offset;\r\n\t\t\t}\r\n\r\n\t\t\tr = this.fixHorizontalCoordinate(r);\r\n\t\t\tl = this.fixHorizontalCoordinate(l);\r\n\t\t\tt = this.fixVerticalCoordinate(t);\r\n\t\t\tb = this.fixVerticalCoordinate(b);\r\n\t\t}\r\n\t\telse if (this.baseAxis == this.xAxis) {\r\n\r\n\t\t\tif (!dataItem.hasValue(this._yValueFields)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// in case width is set in percent\r\n\t\t\tif (!$type.isNaN(percentWidth)) {\r\n\t\t\t\tlet offset: number = $math.round((endLocation - startLocation) * (1 - percentWidth / 100) / 2, 5);\r\n\t\t\t\tstartLocation += offset;\r\n\t\t\t\tendLocation -= offset;\r\n\t\t\t}\r\n\r\n\t\t\tl = this.xAxis.getX(dataItem, xOpenField, startLocation);\r\n\t\t\tr = this.xAxis.getX(dataItem, xField, endLocation);\r\n\r\n\t\t\t// in case width is set in pixels\r\n\t\t\tif ($type.isNaN(percentWidth)) {\r\n\t\t\t\tlet offset: number = ((r - l) - pixelWidth) / 2;\r\n\t\t\t\tl += offset;\r\n\t\t\t\tr -= offset;\r\n\t\t\t}\r\n\r\n\t\t\t// in case width is set in pixels\r\n\t\t\tif (!$type.isNaN(maxWidth) && maxWidth < Math.abs(r - l)) {\r\n\t\t\t\tlet offset: number = ((r - l) - maxWidth) / 2;\r\n\t\t\t\tl += offset;\r\n\t\t\t\tr -= offset;\r\n\t\t\t}\r\n\r\n\t\t\tlet bottomLocation = dataItem.locations[yOpenField];\r\n\t\t\tlet topLocation = dataItem.locations[yField];\r\n\t\t\t// otherwise gantt chart will start items in the middle of a cell\r\n\t\t\tif (this.yAxis instanceof ValueAxis) {\r\n\t\t\t\tif ((<any>this.dataFields)[this.yField] != (<any>this.dataFields)[this.yOpenField]) {\r\n\t\t\t\t\tbottomLocation = 0;\r\n\t\t\t\t\ttopLocation = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tb = this.yAxis.getY(dataItem, yOpenField, bottomLocation);\r\n\t\t\tt = this.yAxis.getY(dataItem, yField, topLocation);\r\n\r\n\t\t\t// used to save location for bullets, but it's not a good approach\r\n\t\t\t// dataItem.locations[xField] = startLocation + (endLocation - startLocation) / 2;\r\n\r\n\t\t\tlet axisLenght = Math.ceil(this.yAxis.axisLength);\r\n\r\n\t\t\tif ((t < 0 && b < 0) || (t > axisLenght && b > axisLenght)) {\r\n\t\t\t\toutOfBounds = true;\r\n\t\t\t}\r\n\r\n\t\t\tt = this.fixVerticalCoordinate(t);\r\n\t\t\tb = this.fixVerticalCoordinate(b);\r\n\r\n\t\t\tif (Math.abs(r - l) - paddingLeft - paddingRight == 0) {\r\n\t\t\t\toutOfBounds = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// horizontal bars\r\n\t\telse {\r\n\t\t\tif (!dataItem.hasValue(this._xValueFields)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.isNaN(percentHeight)) {\r\n\t\t\t\tlet offset: number = $math.round((endLocation - startLocation) * (1 - percentHeight / 100) / 2, 5);\r\n\t\t\t\tstartLocation += offset;\r\n\t\t\t\tendLocation -= offset;\r\n\t\t\t}\r\n\r\n\t\t\tt = this.yAxis.getY(dataItem, yOpenField, startLocation);\r\n\t\t\tb = this.yAxis.getY(dataItem, yField, endLocation);\r\n\r\n\t\t\t// in case height is set in pixels\r\n\t\t\tif ($type.isNaN(percentHeight)) {\r\n\t\t\t\tlet offset: number = ((b - t) - pixelHeight) / 2;\r\n\t\t\t\tb -= offset;\r\n\t\t\t\tt += offset;\r\n\t\t\t}\r\n\r\n\t\t\t// in case height is set in pixels\r\n\t\t\tif (!$type.isNaN(maxHeight) && maxHeight < Math.abs(b - t)) {\r\n\t\t\t\tlet offset: number = ((b - t) - maxHeight) / 2;\r\n\t\t\t\tb -= offset;\r\n\t\t\t\tt += offset;\r\n\t\t\t}\r\n\r\n\t\t\tlet rightLocation = dataItem.locations[xField];\r\n\t\t\tlet leftLocation = dataItem.locations[xOpenField];\r\n\r\n\t\t\t// otherwise gantt chart will start items in the middle of a cell\r\n\t\t\tif (this.xAxis instanceof ValueAxis) {\r\n\t\t\t\tif ((<any>this.dataFields)[this.xField] != (<any>this.dataFields)[this.xOpenField]) {\r\n\t\t\t\t\trightLocation = 0;\r\n\t\t\t\t\tleftLocation = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tr = this.xAxis.getX(dataItem, xField, rightLocation);\r\n\t\t\tl = this.xAxis.getX(dataItem, xOpenField, leftLocation);\r\n\t\t\t// used to save location for bullets, but it's not a good approach\r\n\t\t\t// dataItem.locations[yField] = startLocation + (endLocation - startLocation) / 2;\r\n\r\n\t\t\tlet axisLenght = Math.ceil(this.xAxis.axisLength);\r\n\r\n\t\t\tif ((r < 0 && l < 0) || (r > axisLenght && l > axisLenght)) {\r\n\t\t\t\toutOfBounds = true;\r\n\t\t\t}\r\n\r\n\t\t\tr = this.fixHorizontalCoordinate(r);\r\n\t\t\tl = this.fixHorizontalCoordinate(l);\r\n\r\n\t\t\tif (Math.abs(t - b) - paddingTop - paddingBottom == 0) {\r\n\t\t\t\toutOfBounds = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet w: number = Math.abs(r - l);\r\n\t\tlet h: number = Math.abs(b - t);\r\n\r\n\t\tlet x: number = Math.min(l, r);\r\n\t\tlet y: number = Math.min(t, b);\r\n\r\n\t\tif (!outOfBounds) {\r\n\t\t\tlet column: this[\"_column\"];\r\n\t\t\tif (!dataItem.column) {\r\n\t\t\t\tcolumn = this.columns.create();\r\n\t\t\t\t//$object.forceCopyProperties(this.columns.template, column, visualProperties);\r\n\t\t\t\t$object.copyProperties(this, column, visualProperties); // need this because 3d columns are not in the same container\r\n\t\t\t\t$object.copyProperties(this.columns.template, column, visualProperties); // second time, no force, so that columns.template would override series properties\r\n\t\t\t\tdataItem.addSprite(column);\r\n\r\n\t\t\t\tdataItem.column = column;\r\n\t\t\t\tcolumn.paper = this.paper; // sometimes pattern is not drawn if is set with adapter without this.\r\n\r\n\t\t\t\t// accessibility\r\n\t\t\t\tif (this.itemsFocusable()) {\r\n\t\t\t\t\tif (!$type.hasValue(this.role)) {\r\n\t\t\t\t\t\tthis.role = \"menu\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!$type.hasValue(column.role)) {\r\n\t\t\t\t\t\tcolumn.role = \"menuitem\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcolumn.focusable = true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (!$type.hasValue(this.role)) {\r\n\t\t\t\t\t\tthis.role = \"list\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!$type.hasValue(column.role)) {\r\n\t\t\t\t\t\tcolumn.role = \"listitem\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcolumn.focusable = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (column.focusable) {\r\n\t\t\t\t\tcolumn.events.on(\"focus\", (ev) => {\r\n\t\t\t\t\t\tcolumn.readerTitle = this.populateString(this.itemReaderText, dataItem);\r\n\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t\tcolumn.events.on(\"blur\", (ev) => {\r\n\t\t\t\t\t\tcolumn.readerTitle = \"\";\r\n\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t}\r\n\t\t\t\tif (column.hoverable) {\r\n\t\t\t\t\tcolumn.events.on(\"over\", (ev) => {\r\n\t\t\t\t\t\tcolumn.readerTitle = this.populateString(this.itemReaderText, dataItem);\r\n\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t\tcolumn.events.on(\"out\", (ev) => {\r\n\t\t\t\t\t\tcolumn.readerTitle = \"\";\r\n\t\t\t\t\t}, undefined, false);\r\n\t\t\t\t}\r\n\t\t\t\tcolumn.parent = this.columnsContainer;\r\n\t\t\t\tcolumn.virtualParent = this;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcolumn = dataItem.column;\r\n\t\t\t\tif (this._propertiesChanged) {\r\n\t\t\t\t\t$object.copyProperties(this, column, visualProperties);\r\n\t\t\t\t\t$object.copyProperties(this.columns.template, column, visualProperties);\r\n\t\t\t\t\t$array.each(visualProperties, (property) => {\r\n\t\t\t\t\t\t(<any>column)[property] = column[property];\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcolumn.width = w;\r\n\t\t\tcolumn.height = h;\r\n\r\n\t\t\tcolumn.x = x;\r\n\t\t\tcolumn.y = y;\r\n\r\n\t\t\tcolumn.realX = l;\r\n\t\t\tcolumn.realY = t;\r\n\r\n\t\t\tcolumn.realWidth = r - l;\r\n\t\t\tcolumn.realHeight = b - t;\r\n\r\n\t\t\tthis.setColumnStates(column);\r\n\r\n\t\t\tif (column.invalid) {\r\n\t\t\t\tcolumn.validate(); // validate as if it was used previously, it will flicker with previous dimensions\r\n\t\t\t}\r\n\r\n\t\t\tcolumn.__disabled = false;\r\n\t\t\t//column.returnAfterTemp();\r\n\r\n\t\t\t$iter.each(this.axisRanges.iterator(), (axisRange) => {\r\n\t\t\t\tlet rangeColumn: this[\"_column\"] = dataItem.rangesColumns.getKey(axisRange.uid);\r\n\t\t\t\tif (!rangeColumn) {\r\n\t\t\t\t\trangeColumn = this.columns.create();\r\n\r\n\t\t\t\t\t//$object.forceCopyProperties(this.columns.template, rangeColumn, visualProperties);\r\n\t\t\t\t\t$object.copyProperties(axisRange.contents, rangeColumn, visualProperties); // need this because 3d columns are not in the same container\r\n\r\n\t\t\t\t\tdataItem.addSprite(rangeColumn);\r\n\t\t\t\t\tdataItem.rangesColumns.setKey(axisRange.uid, <Column>rangeColumn);\r\n\t\t\t\t\trangeColumn.paper = this.paper; // sometimes pattern is not drawn if is set with adapter without this.\r\n\t\t\t\t}\r\n\r\n\t\t\t\trangeColumn.parent = axisRange.contents;\r\n\r\n\t\t\t\trangeColumn.width = w;\r\n\t\t\t\trangeColumn.height = h;\r\n\t\t\t\trangeColumn.x = x;\r\n\t\t\t\trangeColumn.y = y;\r\n\r\n\t\t\t\tthis.setColumnStates(rangeColumn);\r\n\r\n\t\t\t\tif (rangeColumn.invalid) {\r\n\t\t\t\t\trangeColumn.validate(); // validate as if it was used previously, it will flicker with previous dimensions\r\n\t\t\t\t}\r\n\r\n\t\t\t\trangeColumn.__disabled = false;\r\n\t\t\t\t//rangeColumn.returnAfterTemp();\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.disableUnusedColumns(dataItem);\r\n\t\t}\r\n\r\n\t\tdataItem.itemWidth = w;\r\n\t\tdataItem.itemHeight = h;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected disableUnusedColumns(dataItem: ColumnSeriesDataItem) {\r\n\t\tif (dataItem) {\r\n\t\t\tif (dataItem.column) {\r\n\t\t\t\t// otherwise might flicker when enabling\r\n\t\t\t\tdataItem.column.width = 0;\r\n\t\t\t\tdataItem.column.height = 0;\r\n\t\t\t\tdataItem.column.__disabled = true;\r\n\t\t\t}\r\n\r\n\t\t\t$iter.each(this.axisRanges.iterator(), (axisRange) => {\r\n\t\t\t\tlet rangeColumn: Sprite = dataItem.rangesColumns.getKey(axisRange.uid);\r\n\t\t\t\tif (rangeColumn) {\r\n\t\t\t\t\t// otherwise might flicker when enabling\r\n\t\t\t\t\trangeColumn.width = 0;\r\n\t\t\t\t\trangeColumn.height = 0;\r\n\t\t\t\t\trangeColumn.__disabled = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Apply different state/coloring to columns based on the change value.\r\n\t *\r\n\t * @param sprite  Sprite to apply state to\r\n\t * @todo Do not apply accessibility to wicks of the candlesticks\r\n\t */\r\n\tprotected setColumnStates(sprite: Sprite): void {\r\n\t\tif (this._dropFromOpenState || this._dropFromPreviousState || this._riseFromOpenState || this._riseFromPreviousState) {\r\n\r\n\t\t\tlet dataItem: this[\"_dataItem\"] = <this[\"_dataItem\"]>sprite.dataItem;\r\n\r\n\t\t\tif (this.xAxis instanceof ValueAxis || this.yAxis instanceof ValueAxis) {\r\n\t\t\t\tlet open: number;\r\n\t\t\t\tlet value: number;\r\n\t\t\t\tlet change: number;\r\n\r\n\t\t\t\tif (this.baseAxis == this.yAxis) {\r\n\t\t\t\t\tif (this.xOpenField && this.xField && this.xAxis instanceof ValueAxis) {\r\n\t\t\t\t\t\topen = dataItem.getValue(this.xOpenField);\r\n\t\t\t\t\t\tvalue = dataItem.getValue(this.xField);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchange = dataItem.getValue(this.xAxis.axisFieldName + \"X\", \"previousChange\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this.yOpenField && this.yField && this.yAxis instanceof ValueAxis) {\r\n\t\t\t\t\t\topen = dataItem.getValue(this.yOpenField);\r\n\t\t\t\t\t\tvalue = dataItem.getValue(this.yField);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchange = dataItem.getValue(this.yAxis.axisFieldName + \"Y\", \"previousChange\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value < open) {\r\n\t\t\t\t\tdataItem.droppedFromOpen = true;\r\n\t\t\t\t\tsprite.defaultState.copyFrom(this._dropFromOpenState)\r\n\t\t\t\t\tsprite.setState(this._dropFromOpenState, 0);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdataItem.droppedFromOpen = false;\r\n\t\t\t\t\tsprite.defaultState.copyFrom(this._riseFromOpenState)\r\n\t\t\t\t\tsprite.setState(this._riseFromOpenState, 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (change < 0) {\r\n\t\t\t\t\tdataItem.droppedFromPrevious = true;\r\n\t\t\t\t\tsprite.defaultState.copyFrom(this._dropFromPreviousState)\r\n\t\t\t\t\tsprite.setState((this._dropFromPreviousState), 0);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdataItem.droppedFromPrevious = false;\r\n\t\t\t\t\tsprite.defaultState.copyFrom(this._riseFromPreviousState)\r\n\t\t\t\t\tsprite.setState((this._riseFromPreviousState), 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A list of column elements in the series.\r\n\t *\r\n\t * @return Columns\r\n\t */\r\n\tpublic get columns(): ListTemplate<this[\"_column\"]> {\r\n\t\tif (!this._columns) {\r\n\t\t\tthis._columns = new ListTemplate<this[\"_column\"]>(this.createColumnTemplate());\r\n\t\t\tthis._disposers.push(new ListDisposer(this._columns));\r\n\t\t\tthis._disposers.push(this._columns.template);\r\n\t\t}\r\n\t\treturn this._columns;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns a column element to use as a template.\r\n\t *\r\n\t * @return Column template\r\n\t */\r\n\tprotected createColumnTemplate(): this[\"_column\"] {\r\n\t\treturn new Column();\r\n\t}\r\n\r\n\t/**\r\n\t * Cluster this series columns?\r\n\t *\r\n\t * Setting to `false` will make columns overlap with other series.\r\n\t *\r\n\t * @default true\r\n\t * @param value  Clustered?\r\n\t */\r\n\tpublic set clustered(value: boolean) {\r\n\t\tthis.setPropertyValue(\"clustered\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Clustered?\r\n\t */\r\n\tpublic get clustered(): boolean {\r\n\t\treturn this.getPropertyValue(\"clustered\");\r\n\t}\r\n\r\n\t/**\r\n\t * A state to apply to a column when close value is lower than open value.\r\n\t *\r\n\t * Can be used to differentiate appearance based on value relations.\r\n\t *\r\n\t * NOTE: this will work only if at least one axis is [[ValueAxis]].\r\n\t *\r\n\t * @readonly You can modify state object, but can't overwrite it\r\n\t * @param  value  State\r\n\t */\r\n\tpublic set dropFromOpenState(value: SpriteState<this[\"_properties\"], this[\"_adapter\"]>) {\r\n\t\tthis._dropFromOpenState = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return State\r\n\t */\r\n\tpublic get dropFromOpenState(): SpriteState<this[\"_properties\"], this[\"_adapter\"]> {\r\n\t\tif (!this._dropFromOpenState) {\r\n\t\t\tthis._dropFromOpenState = this.states.create(\"dropFromOpenState\");\r\n\t\t}\r\n\t\treturn this._dropFromOpenState;\r\n\t}\r\n\r\n\t/**\r\n\t * A state to apply to a column when its value is lower value of a previous\r\n\t * column.\r\n\t *\r\n\t * Can be used to differentiate appearance based on value relations.\r\n\t *\r\n\t * @readonly You can modify state object, but can't overwrite it\r\n\t * @param  value  State\r\n\t */\r\n\tpublic set dropFromPreviousState(value: SpriteState<this[\"_properties\"], this[\"_adapter\"]>) {\r\n\t\tthis._dropFromPreviousState = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return State\r\n\t */\r\n\tpublic get dropFromPreviousState(): SpriteState<this[\"_properties\"], this[\"_adapter\"]> {\r\n\t\tif (!this._dropFromPreviousState) {\r\n\t\t\tthis._dropFromPreviousState = this.states.create(\"dropFromPreviousState\");\r\n\t\t}\r\n\t\treturn this._dropFromPreviousState;\r\n\t}\r\n\r\n\t/**\r\n\t * A state to apply to a column when close value is same or higher than open\r\n\t * value.\r\n\t *\r\n\t * Can be used to differentiate appearance based on value relations.\r\n\t *\r\n\t * NOTE: this will work only if at least one axis is [[ValueAxis]].\r\n\t *\r\n\t * @readonly You can modify state object, but can't overwrite it\r\n\t * @param  value  State\r\n\t */\r\n\tpublic set riseFromOpenState(value: SpriteState<this[\"_properties\"], this[\"_adapter\"]>) {\r\n\t\tthis._riseFromOpenState = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return State\r\n\t */\r\n\tpublic get riseFromOpenState(): SpriteState<this[\"_properties\"], this[\"_adapter\"]> {\r\n\t\tif (!this._riseFromOpenState) {\r\n\t\t\tthis._riseFromOpenState = this.states.create(\"riseFromOpenState\");\r\n\t\t}\r\n\t\treturn this._riseFromOpenState;\r\n\t}\r\n\r\n\t/**\r\n\t * A state to apply to a column when its value is same or higher than value\r\n\t * of a previous column.\r\n\t *\r\n\t * Can be used to differentiate appearance based on value relations.\r\n\t *\r\n\t * @readonly You can modify state object, but can't overwrite it\r\n\t * @param  value  State\r\n\t */\r\n\tpublic set riseFromPreviousState(value: SpriteState<this[\"_properties\"], this[\"_adapter\"]>) {\r\n\t\tthis._riseFromPreviousState = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return State\r\n\t */\r\n\tpublic get riseFromPreviousState(): SpriteState<this[\"_properties\"], this[\"_adapter\"]> {\r\n\t\tif (!this._riseFromPreviousState) {\r\n\t\t\tthis._riseFromPreviousState = this.states.create(\"riseFromPreviousState\");\r\n\t\t}\r\n\t\treturn this._riseFromPreviousState;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates value of the related legend item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param dataItem  Data item\r\n\t */\r\n\tpublic updateLegendValue(dataItem?: this[\"_dataItem\"], notRange?: boolean) {\r\n\t\tsuper.updateLegendValue(dataItem, notRange);\r\n\r\n\t\tif (this.legendDataItem) {\r\n\t\t\tlet marker: Container = this.legendDataItem.marker;\r\n\t\t\tlet fromOpenState: SpriteState<this[\"_properties\"], this[\"_adapter\"]>;\r\n\t\t\tlet fromPreviousState: SpriteState<this[\"_properties\"], this[\"_adapter\"]>;\r\n\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tif (dataItem.droppedFromOpen) {\r\n\t\t\t\t\tfromOpenState = this._dropFromOpenState;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tfromOpenState = this._riseFromOpenState;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (dataItem.droppedFromPrevious) {\r\n\t\t\t\t\tfromPreviousState = this._dropFromPreviousState;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tfromPreviousState = this._riseFromPreviousState;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$iter.each(marker.children.iterator(), (child) => {\r\n\t\t\t\tif (dataItem) {\r\n\t\t\t\t\tchild.setState(fromPreviousState);\r\n\t\t\t\t\tchild.setState(fromOpenState);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// todo: think what to do here, maybe apply above states based on totals?\r\n\t\t\t\t\tchild.setState(this._riseFromPreviousState);\r\n\t\t\t\t\tchild.setState(this._riseFromOpenState);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates elements in related legend container, that mimics the look of this\r\n\t * Series.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param marker  Legend item container\r\n\t */\r\n\tpublic createLegendMarker(marker: Container) {\r\n\t\tlet w: number = marker.pixelWidth;\r\n\t\tlet h: number = marker.pixelHeight;\r\n\r\n\t\tmarker.removeChildren();\r\n\r\n\t\tlet column: RoundedRectangle = marker.createChild(RoundedRectangle);\r\n\t\tcolumn.shouldClone = false;\r\n\t\t$object.copyProperties(this, column, visualProperties);\r\n\r\n\t\tcolumn.copyFrom(<any>this.columns.template);\r\n\t\tcolumn.padding(0, 0, 0, 0); // if columns will have padding (which is often), legend marker will be very narrow\r\n\t\tcolumn.width = w;\r\n\t\tcolumn.height = h;\r\n\r\n\t\tlet legendDataItem = <LegendDataItem>marker.dataItem;\r\n\t\tlegendDataItem.color = this.fill;\r\n\t\tlegendDataItem.colorOrig = this.fill;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties from another instance of [[ColumnSeries]].\r\n\t *\r\n\t * @param source  Source series\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.columns.template.copyFrom(source.columns.template);\r\n\t}\r\n\r\n\t/**\r\n\t* returns bullet x location\r\n\t* @ignore\r\n\t*/\r\n\r\n\tprotected getBulletLocationX(bullet: Bullet, field: string): number {\r\n\t\tif (this.baseAxis == this.xAxis) {\r\n\t\t\tlet bulletLocationX = bullet.locationX;\r\n\t\t\tif (!$type.isNumber(bulletLocationX)) {\r\n\t\t\t\tbulletLocationX = 0.5;\r\n\t\t\t}\r\n\r\n\t\t\tlet endLocation = this.getEndLocation(<ColumnSeriesDataItem>bullet.dataItem);\r\n\t\t\tlet startLocation = this.getStartLocation(<ColumnSeriesDataItem>bullet.dataItem);\r\n\r\n\t\t\treturn endLocation - (endLocation - startLocation) * bulletLocationX;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn super.getBulletLocationX(bullet, field);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t* returns bullet y location\r\n\t* @ignore\r\n\t*/\r\n\tprotected getBulletLocationY(bullet: Bullet, field: string): number {\r\n\t\tif (this.baseAxis == this.yAxis) {\r\n\t\t\tlet bulletLocationY = bullet.locationY;\r\n\t\t\tif (!$type.isNumber(bulletLocationY)) {\r\n\t\t\t\tbulletLocationY = 0.5;\r\n\t\t\t}\r\n\r\n\t\t\tlet endLocation = this.getEndLocation(<ColumnSeriesDataItem>bullet.dataItem);\r\n\t\t\tlet startLocation = this.getStartLocation(<ColumnSeriesDataItem>bullet.dataItem);\r\n\r\n\t\t\treturn endLocation - (endLocation - startLocation) * bulletLocationY;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn super.getBulletLocationY(bullet, field);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getAdjustedXLocation(dataItem: this[\"_dataItem\"], field: string, bulletLocationX?: number) {\r\n\t\t//if (this.baseAxis == this.xAxis) {\r\n\t\tif (!$type.isNumber(bulletLocationX)) {\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tbulletLocationX = dataItem.locations[field];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbulletLocationX = 0.5;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._endLocation - (this._endLocation - this._startLocation) * (1 - bulletLocationX);\r\n\t\t//}\r\n\t\t//else {\r\n\t\t//\treturn super.getAdjustedXLocation(dataItem, field);\r\n\t\t//}\r\n\t}\r\n\r\n\tprotected getAdjustedYLocation(dataItem: this[\"_dataItem\"], field: string, bulletLocationY?: number) {\r\n\t\t//if (this.baseAxis == this.yAxis) {\r\n\t\tif (!$type.isNumber(bulletLocationY)) {\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tbulletLocationY = dataItem.locations[field];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbulletLocationY = 0.5;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._endLocation - (this._endLocation - this._startLocation) * bulletLocationY;\r\n\t\t//}\r\n\t\t//else {\r\n\t\t//\treturn super.getAdjustedYLocation(dataItem, field);\r\n\t\t//}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected fixVerticalCoordinate(coordinate: number): number {\r\n\t\tlet paddingBottom = this.columns.template.pixelPaddingBottom;\r\n\t\tlet paddingTop = this.columns.template.pixelPaddingTop;\r\n\r\n\t\tlet minY: number = -paddingTop;\r\n\t\tlet maxY: number = this.yAxis.axisLength + paddingBottom;\r\n\r\n\t\treturn $math.fitToRange(coordinate, minY, maxY);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected fixHorizontalCoordinate(coordinate: number): number {\r\n\t\tlet paddingLeft = this.columns.template.pixelPaddingLeft;\r\n\t\tlet paddingRight = this.columns.template.pixelPaddingRight;\r\n\r\n\t\tlet minX: number = -paddingLeft;\r\n\t\tlet maxX: number = this.xAxis.axisLength + paddingRight;\r\n\r\n\t\treturn $math.fitToRange(coordinate, minX, maxX);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic disposeData() {\r\n\t\tsuper.disposeData();\r\n\t\tthis.columns.clear();\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"ColumnSeries\"] = ColumnSeries;\r\nregistry.registeredClasses[\"ColumnSeriesDataItem\"] = ColumnSeriesDataItem;\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}